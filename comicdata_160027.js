var captions = [];

// Page 1
captions[1] = [ 
"You are a student at L. Roman High School, a special high school for the most ordinary, average students.<br> Today is Monday. On Friday, every student will take a Very important exam, which will determine whether they succeed or fail in life.", 

"What is your name?" ];

// Page 2, etc.
captions[2] = [
"Your name is Honda Accord. (Your parents gave you this name because they were driving by the Honda dealership on the way home from the Baby Factory.) Don't be fooled by this name; you are truly an ordinary human sitting in a very overcrowded, stale-aired classroom.<br><br>Your eyes are focused on the mysterious text on the blackboard.",

"Teacher: Students! Pay close attention to what is written on the board! <b>This is a very important exam.</b> Every one of you will be required to take it. It is not graded like your typical assignments. There is only two possible grades on this exam; you can either pass or fail. <br><br>If you fail the exam, you are never leaving this school. You will be sent back to \"The Third Grade\". None of you want that now, do you? I didn't think so.<br><br><b>Now, class, are there any questions before we move on?</b>"
];

captions[3] = [
"Teacher: Yes, Accord.<br><br>Accord: Teacher, can we review \"Dee's\"?<br><br>Teacher: What are \"Dee's\"?<br><br>Accord: Dee's Nu--",

"Teacher: <b>Nonononononononono. That's it. I think it's time for you to leave. We'll be fine, you just have to <i>go.</i></b><br><br>(You are forcibly expulsed from class for a little while due to your disruption. The hallway is nearly empty because students are currently in class right now... the well-behaving ones at least...) <br><br>(Where do you go now?)"
];

captions[4] = [
"You sneak into the school cafeteria and swiftly snatch all the Dootos™ from the back room without making a sound. Now the school's entire supply of Dootos™ is finally yours. (The rest of the cafeteria food was decidedly Not Very Tasty.)<br><br>You wonder what the red button does. Hmm.. that could be dangerous. It's not good to bring attention to yourself at this time. (However, if the urge comes to you, there really is no way to stop it...)"
];

captions[5] = [
"A shiver travels down your spine and your heart races as you remember the terrible Dootos™ Incident...<br><br>One year ago, an unidentified masked person entered the campus carrying an incendiary explosive made from Spicy Hot Dootos™ dust. The entire school was suddenly engulfed in flames and evacuated.<br><br>You remember smelling the burnt Dooto™ dust everywhere... and the earth-shattering explosions in every direction... and... ██████████████...<br><br>It was never disclosed how many people lived or died. Discussing the Incident has been strictly forbidden ever since.",

"While you were having the flashbacks, a school administrator sneaks up behind you, suspicious of what you are up to.<br><br>Admin: <b>What are you doing with all these Dootos™???</b>"
]

captions[6] = [
"Accord: <b>IM NOT BUILDING EXPLOSIVES</b><br>Admin: ...<br>Admin: ...<br>Admin: ...",
"Admin: Well... okay, if you say so. <br>Admin: Also... you should... get back to class!! There's... umm... an hour till lunch!",
"The cafeteria is totally empty once more. The red button is still there unpressed, but it is probably unwise to press it.<br> Your teacher might be waiting for you... or perhaps enjoying the peace and quiet? You could choose to return to class, or go somewhere else instead... <br><br>Also, what in the world are you going to do with all those Dootos™???"
]

captions[7] = [
"You try to pick up the red button. Huh... you're right! It isn't attached to anything. But there is this warning written on it... hmm... this is probably just inconsequential boilerplate text...",
"(You have obtained the Emergency Button. Try not to sit a certain way or it might go off in your pocket...)",
"You are still walking around the cafeteria. The clock says 11:03 AM-- 57 minutes till lunch. There isn't anyone in sight. What do you do now?"
]

captions[8] = [
"You peek under the table and--<br><br>Accord: <b>AAAAAAAAAAAAAAAAAA</b>",
"Accord: <b>AAAARGHHH!! A talking button!!!</b><br>??????: ...<br> ??????: A button I am not... if you press me it will do you no good... Honda Accord, I expected your arrival. I know exactly what brought you here, the result of your many urges within."
]

captions[9] = [
"You pick up the strange orb and begin biting into it. The orb stoically shows no sign of resistance. It does not say a word.<br>You find the ball to be easily chewable, and your mouth is quickly filled with an incredibly bitter and possibly moldy taste.",
"As you chew on the ball you feel a strange warmth like nothing you have ever felt before. Soon afterward you start feeling extremely nauseated and begin wandering the hallways aimlessly. You aren't sure what time it is anymore.<br><br>Your classroom is right by here. The nurse's office is also not far away. Where do you go now?"
]

captions[10] = [
"(The nausea intensifies. You collapse to the ground as the familiar voices begins echoing, resonating against your Mind's Ear... )<br><br>??????: Dearest Honda Accord, now that my spirit and your spirit are one, just as predicted, it is time for you to become aware...<br>??????: As you see, you are being watched by many eyes... your soul is not onefold as the others are.<br>??????: The endless tempest that drives your Will... it is a result of this, you see?<br>??????: One day, you must confront these Watchers, and break free your spirit from them. Otherwise, your life will surely be led to ruin.",

"??????: That time is not now, however. Your mind will not remember this, but somewhere in your heart kindles a spark.<br><br>(The visions fade and you find yourself beached in front of your classroom. The dizzy sensation starts to subside. The warmth you once felt has given way to cold and staleness.<br><br>Where is your teacher in all this? Where are the classmates? Have they not gone looking for you? You are unsure.)"
]

captions[11] = [
"You open up your cellular device and sign into FaceSpace. You begin posting about your bizarre experiences so as to not forget them. Within minutes, your writings are immediately ridiculed by the other students. After all, this is a school for ordinary, normal students. Why would you be here if you were special as the ball-headed being claimed?",

"You are sitting in the hallway reading all the mocking replies when... oh no... it's almost noon. In a few moments, it will be lunchtime, and the halls will be filled with people. What are you going to do? Will you find a place to hide, or subject yourself to even more bullying?"
]

captions[12] = [
"You hurry to the janitor's storage room, and make it in the door just as the lunch bell rings. On first glance, the room is dimly lit and a little bit eerie.",
"On closer inspection, the room is more than a little eerie. Cockroaches and spiders are crawling along the walls... noxious chemicals with vile odors line the shelves. The fumes are uncomfortable to breathe in.<br>Directly above you, there is a single vent-- possibly the only way out of this room besides the door you came in."
]

captions[13] = [
"You reach for the container lying on the shelf marked \"LYE\" and open it up. The container is unexpectedly warm.<br><br>As it turns out, the manufacturer was lying. There is only an assortment of Hot Chip inside. Steaming, scalding circuitry floats upon a strange liquid flux. The dissapointment within you grows greater with each approaching moment.",

"Just as you take the deceitful container down from the shelf to get a better look, the door begins to creak open. The janitor is about to come in. What do you do?"
]

captions[14] = [
"Janitor: hmm... my broom looks a lil bit strange today, huh...?<br>Janitor: ...<br>Janitor: ... mmh. probably just my imagination... doo do doooo...",
"Janitor: it aren't cleaning the floor very well neither... hmhm... oh well...<br>Janitor: hopefully this spot comes out eventually...<br>Janitor: until thennn... ummm... uhhh... i'll just keep sweeping... doo do dooo do doo..."
]

captions[15] = [
"You attempt to noclip through the floor by rapidly squashing and thrusting your body downward. Though this technique eludes you still, as you cannot defy the laws of physics, the sudden movement is enough to free yourself from the janitor's grasp.",
"You quickly stride away down a nearby hallway to one of the locker areas. By now most of the students are in the cafeteria having lunch, but some are still on their way there.<br>Where do you go now?"
]

captions[16] = [
"(You grab your lunchbox and walk to the cafeteria as inconspicuously as you can. Even before you can sit down and talk to anyone, there are some people who recognize you, and others who are minding their own business.)<br><br>Student: look its the freakadooky squeeky balooky spleeky . you friggle swibble sloppb . i bet you think you , umm .. go to the mars ..",
"Accord: Hello. How do you do.<br><br>Student: your cant hide .. your weirdness .. you think your so normal.. freakle... go back to weirdo scool..<br><br>Accord: Are you enjoying this luncheon. The nutrient broth is delectable, is it not?<br><br>Student: you dont belong here.. your.. <b>IMPOSTER!!!</b>",
"(He goes reaching for the middle of the table, looking for the Emergency Button, but it is not there anymore... hmm...)" 
]

var commands = [ 
"begin",
"name: Honda accord",
"\"Teacher, can we review 'Dee's'\"?",
"Raid the cafeteria for food while everyone else is in class",
"shiver and recall The Dootos™ Incident",
"immediately blurt out that you're not building explosives",
"Take the red button with you for later, just in case. Nobody ever said it was attached to anything....!",
"No button lies alone. Look under the table.",
"Attempt to put the head in your mouth and chew.",
"listen to the voices. give in to the voices.",
"Excitedly post on your Facespace: \"just had the wildest trip haha.. endless tempest man\"",
"Run and hide in the janitor's storage room.",
"notice the lye on the shelf. find the truth behind this lye.",
"quickly drop the jar, go to the corner and do a headstand against the walls- your best impression of a Broom!",
"escape by noclipping through the floor",
"act Normal and get your lunch like a Normal Student. Make Normal Small talk with the other Normal students, careful to take Normal sized bites of your food."
];

class Panel {
	constructor(){
		this.image   = "";
		this.caption = "";
	}
	
	getHTML(){
		
		var outstring = "";
		
		// The image panel
		outstring += "<div class=\"panel\">"
		outstring += "<img src=\"" + this.image + "\">"
		outstring += "</div>"
		
		// The caption panel
		outstring += "<div class=\"bodydiv\">"
		outstring += this.caption
		outstring += "</div>"
		
		return outstring;
	}
}

class Page {
	constructor( index ){
		this.panels = [];
		this.index  = index;
		
		for (var i = 0; i < captions[index].length; i++){
			
			this.addPanel( new Panel() );
			
		}
	}
	
	addPanel( panel ){
		
		var captionstring = captions[this.index][this.panels.length];
		panel.caption = captionstring;
		
		this.panels.push( panel );
		
		var imagestring = "img/" + this.index + "_" + this.panels.length + ".png"
		panel.image = imagestring;

	}
	
	getHTML(){
		var code = "";
		
		// Top bar with the command of last time
		
		code += "<div class=\"tittle\">"
		code += "<h2>> " + commands[ this.index - 1 ] + "</h2>"
		code += "</div>"
		
		// Contents of all panels
		
		for (var i = 0; i < this.panels.length; i++){
			var panel = this.panels[i];
			
			code += panel.getHTML();
		}
		
		// Controls to go onto the next page
		
		code += "<div class=\"controls\">"
		if ( this.index < commands.length ){
			code += "<h3> > <a href=\"" + (this.index+1) + ".html\">" + commands[this.index] + "</a> </h3>"
		}
		code += "</div>"
		
		// Back button
		
		if (this.index == 1){
			code +=	"<h3><a href=\"index.html\"><== </a></h3>"
		}else{
			code +=	"<h3><a href=\"" + (this.index - 1) + ".html\"><== </a></h3>"
		}
		
		
		return code;
	}
}

// The index of the page is found between the slash and the dot (i.e. "/1.html")

var slashindex = location.pathname.lastIndexOf("/") + 1;
var dotindex   = location.pathname.lastIndexOf(".");
var pagename = location.pathname.substring(slashindex, dotindex);
var pageindex = parseInt( pagename, 10 );

var page = new Page(pageindex);

var maindiv = document.getElementById("maindiv"); 
var innercode = maindiv.innerHTML;

innercode += page.getHTML();

maindiv.innerHTML = innercode;

if( window.localStorage )
{
if( !localStorage.getItem('firstLoad') )
{
  localStorage['firstLoad'] = true;
  window.location.reload(true); console.log("loaded without cache");
}  
else
  localStorage.removeItem('firstLoad');
}

